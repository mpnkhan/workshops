/*! amcharts-accessibility-plugin - v0.0.1 - 2016-06-27
* Copyright (c) 2016 PayPal Accessibility Team; Licensed BSD */
var amChartAccess={};!function(){"use strict";amChartAccess.prototype={stockchart:null,sChart:null,statusDiv:null,startIndex:0,endIndex:0,graphs:null,panelsContainer:null,dragger:null,iconLeft:null,iconRight:null,initLeftPos:0,initRightPos:0,ind:-1,sliderMin:0,sliderMax:0,step:1,scrollWidth:0,allBullets:null,chartLabel:"Chart from",chartHlpTxtNav:"Press Left or Right Arrow to Navigate",chartHlpTxtStart:"Start of Chart",chartHlpTxtEnd:"End of Chart",leftSliderLabel:"Start",rightSliderLabel:"End",init:function(stockchart,chartArguments){this.setUpConfig(stockchart,chartArguments),this.createStatusDiv(),this.createChartLabel(),this.addChartListeners(),this.addAriaLeftSlider(),this.addAriaRightSlider()},setUpConfig:function(stockchart,chartArguments){this.stockchart=stockchart,this.sChart=stockchart.scrollbarChart,this.panelsContainer=this.stockchart.panelsContainer,this.startIndex=this.sChart.startIndex,this.endIndex=this.sChart.endIndex,this.graphs=stockchart.panels[0].graphs,this.iconLeft=this.sChart.chartScrollbar.iconLeft,this.iconRight=this.sChart.chartScrollbar.iconRight,this.sliderMin=AmCharts.formatDate(this.sChart.chartData[0].category,this.sChart.balloonDateFormat),this.sliderMax=AmCharts.formatDate(this.sChart.chartData[this.sChart.chartData.length-1].category,this.sChart.balloonDateFormat),this.step=this.sChart.chartScrollbar.stepWidth,this.dragger=this.sChart.chartScrollbar.dragger,this.initRightPos=this.sChart.chartScrollbar.width,this.scrollWidth=this.sChart.chartScrollbar.width,this.chartLabel=chartArguments.chartLabel,this.chartHlpTxtNav=chartArguments.chartHlpTxtNav,this.chartHlpTxtStart=chartArguments.chartHlpTxtStart,this.chartHlpTxtEnd=chartArguments.chartHlpTxtEnd,this.leftSliderLabel=chartArguments.leftSliderLabel,this.rightSliderLabel=chartArguments.rightSliderLabel},createStatusDiv:function(){this.statusDiv=document.createElement("div");var statusStyle=this.statusDiv.style;statusStyle.position="absolute",statusStyle.height="1px",statusStyle.width="1px",statusStyle.overflow="hidden",statusStyle.clip="rect(1px, 1px, 1px, 1px)",this.statusDiv.setAttribute("id","statusDiv"),this.statusDiv.setAttribute("aria-live","polite"),this.statusDiv.setAttribute("aria-atomic","true"),document.getElementById("statusDiv")||this.stockchart.centerContainer.appendChild(this.statusDiv)},createChartLabel:function(){var chart=this.stockchart.chartCursors[0].chart,firstTime=new Date(chart.firstTime),lastTime=new Date(chart.lastTime),startLbl=AmCharts.formatDate(firstTime,"MMM DD"),endLbl=AmCharts.formatDate(lastTime,"MMM DD");this.chartLabel+=startLbl+" to "+endLbl+". ",this.chartLabel+=this.chartHlpTxtNav,this.panelsContainer.setAttribute("aria-label",this.chartLabel),this.panelsContainer.setAttribute("tabIndex",0),this.panelsContainer.setAttribute("role","application")},addChartListeners:function(){var _this=this;AmCharts.isNN&&this.panelsContainer.addEventListener("keydown",function(e){_this.chartKeyNavigation(e)}),AmCharts.isIE&&this.panelsContainer.attachEvent("onkeydown",function(e){_this.chartKeyNavigation(e)})},findInd:function(myArray,searchTerm,property){for(var i=0,len=myArray.length;len>i;i++)if(myArray[i][property]==searchTerm)return i;return-1},chartKeyNavigation:function(e){{var keyCode=e.keyCode||e.which,chartCursor=(this.graphs.length,this.stockchart.chartCursors[0]);this.stockchart.scrollbarChart}if(/(37|39)/.test(keyCode)){this.startIndex=chartCursor.chart.startIndex,this.endIndex=chartCursor.chart.endIndex,39===keyCode&&(this.ind+=1),37===keyCode&&(this.ind-=1),this.ind>this.endIndex&&(this.ind=this.endIndex),this.ind<this.startIndex&&(this.ind=this.startIndex);var curObj=chartCursor.chart.chartData[this.ind];chartCursor.showCursorAt(curObj.category),this.speakBalloon(chartCursor,curObj.category,this.ind,this.startIndex,this.endIndex)}},speakBalloon:function(chartCursor,category,index){var i,graph,graphDataItem,serialDataItem,balloonText,liveText="",j=this.graphs.length,fDate=null;for(fDate=AmCharts.formatDate(category,chartCursor.categoryBalloonDateFormat),liveText=this.sChart.categoryField+" "+fDate+"<br>",i=0;j>i;i++)graph=this.graphs[i],serialDataItem=this.graphs[i].data[index],graphDataItem=serialDataItem.axes[graph.valueAxis.id].graphs[graph.id],balloonText=this.sChart.formatString(graph.balloonText,graphDataItem,graph),liveText=liveText+graph.title+" : "+balloonText+"<br>";index===this.endIndex&&(liveText=this.chartHlpTxtEnd+". "+liveText),index===this.startIndex&&(liveText=this.chartHlpTxtStart+". "+liveText),this.statusDiv.innerHTML=liveText},addAriaLeftSlider:function(){var _this=this,iconLeftLabel=this.leftSliderLabel+this.sChart.categoryField;this.iconLeft.node.setAttribute("aria-label",iconLeftLabel),this.iconLeft.node.setAttribute("tabIndex","0"),this.iconLeft.node.setAttribute("focusable","true"),this.iconLeft.node.setAttribute("role","slider"),this.iconLeft.node.setAttribute("aria-orientation","horizontal"),this.iconLeft.node.setAttribute("aria-valuemin",this.sliderMin),this.iconLeft.node.setAttribute("aria-valuemax",this.sliderMax),this.iconLeft.node.setAttribute("aria-valuetext",this.sliderMin),AmCharts.isNN&&(this.iconLeft.node.addEventListener("keydown",function(e){_this.leftSliderKeyNav(e)}),this.iconLeft.node.addEventListener("focusout",function(){})),AmCharts.isIE&&this.iconLeft.node.attachEvent("onkeydown",function(e){_this.leftSliderKeyNav(e)})},leftSliderKeyNav:function(e){var currTime,keyCode=e.keyCode||e.which;/(37|39)/.test(keyCode)&&(this.step<1&&(this.step=1),39===keyCode&&(this.initLeftPos+=this.step),37===keyCode&&(this.initLeftPos-=this.step),this.initLeftPos>this.scrollWidth&&(this.initLeftPos-=this.step),this.initLeftPos<0&&(this.initLeftPos=0),this.dragger.setAttr("x",this.initLeftPos),this.dragger.setAttr("width",this.initRightPos-this.initLeftPos),this.sChart.chartScrollbar.clipDragger(!0),this.sChart.chartScrollbar.updateOnRelease(),currTime=new Date(this.sChart.startTime),this.iconLeft.node.setAttribute("aria-valuenow",this.initLeftPos),this.iconLeft.node.setAttribute("aria-valuetext",AmCharts.formatDate(currTime,this.sChart.balloonDateFormat)),this.updateChartLabel())},addAriaRightSlider:function(){var _this=this,iconRightLabel=this.rightSliderLabel+this.sChart.categoryField;this.iconRight.node.setAttribute("aria-label",iconRightLabel),this.iconRight.node.setAttribute("tabIndex","0"),this.iconRight.node.setAttribute("focusable","true"),this.iconRight.node.setAttribute("role","slider"),this.iconRight.node.setAttribute("aria-orientation","horizontal"),this.iconRight.node.setAttribute("aria-valuemin",this.sliderMin),this.iconRight.node.setAttribute("aria-valuemax",this.sliderMax),this.iconRight.node.setAttribute("aria-valuetext",this.sliderMax),AmCharts.isNN&&(this.iconRight.node.addEventListener("keydown",function(e){_this.rightSliderKeyNav(e)}),this.iconRight.node.addEventListener("focusout",function(){})),AmCharts.isIE&&this.iconRight.node.attachEvent("onkeydown",function(e){_this.rightSliderKeyNav(e)})},rightSliderKeyNav:function(e){var currEndTime,keyCode=e.keyCode||e.which;/(37|39)/.test(keyCode)&&(39==keyCode&&(this.initRightPos+=this.step),37==keyCode&&(this.initRightPos-=this.step),this.initRightPos<0&&(this.initRightPos=.1),this.initRightPos>this.scrollWidth&&(this.initRightPos=this.scrollWidth),this.dragger.setAttr("width",this.initRightPos-this.initLeftPos),this.sChart.chartScrollbar.clipDragger(!0),this.sChart.chartScrollbar.updateOnRelease(),currEndTime=new Date(this.sChart.endTime),this.iconRight.node.setAttribute("aria-valuenow",this.initRightPos),this.iconRight.node.setAttribute("aria-valuetext",AmCharts.formatDate(currEndTime,this.sChart.balloonDateFormat)),this.updateChartLabel())},updateChartLabel:function(){var startLbl=AmCharts.formatDate(new Date(this.sChart.startTime),"MMM DD"),endLbl=AmCharts.formatDate(new Date(this.sChart.endTime),"MMM DD");this.chartLabel=startLbl+" to "+endLbl+". ",this.chartLabel+=this.chartHlpTxtNav,this.panelsContainer.setAttribute("aria-label",this.chartLabel)}}}();